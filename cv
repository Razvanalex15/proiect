import { useEffect, useState } from "react";

export default function useLocalStorage(key, initialValue) {
  const [value, setValue] = useState(() => {
    try {
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : initialValue;
    } catch {
      return initialValue;
    }
  });

  useEffect(() => {
    try {
      localStorage.setItem(key, JSON.stringify(value));
    } catch {
      // ignore
    }
  }, [key, value]);

  return [value, setValue];
}





















import { createContext, useContext, useMemo } from "react";
import useLocalStorage from "../hooks/useLocalStorage";

const WatchlistContext = createContext(null);

export function WatchlistProvider({ children }) {
  const [watchlistIds, setWatchlistIds] = useLocalStorage("watchlist", []);

  const toggleWatchlist = (movieId) => {
    setWatchlistIds((prev) =>
      prev.includes(movieId) ? prev.filter((id) => id !== movieId) : [...prev, movieId]
    );
  };

  const isInWatchlist = (movieId) => watchlistIds.includes(movieId);

  const value = useMemo(
    () => ({ watchlistIds, toggleWatchlist, isInWatchlist }),
    [watchlistIds]
  );

  return <WatchlistContext.Provider value={value}>{children}</WatchlistContext.Provider>;
}

export function useWatchlist() {
  const ctx = useContext(WatchlistContext);
  if (!ctx) throw new Error("useWatchlist must be used inside WatchlistProvider");
  return ctx;
}


















import { useWatchlist } from "../context/WatchlistContext";

function getRatingClass(rating) {
  const r = Number(rating);
  if (r >= 8) return "rating-good";
  if (r >= 5) return "rating-mid";
  return "rating-bad";
}

export default function MovieCard({ movie }) {
  const { toggleWatchlist, isInWatchlist } = useWatchlist();
  const inList = isInWatchlist(movie.id);

  return (
    <div className="card">
      <img className="poster" src={`/images/${movie.image}`} alt={movie.title} />

      <h3>{movie.title}</h3>

      <p className="meta">
        {movie.genre}{" "}
        <span className={getRatingClass(movie.rating)}>{movie.rating}</span>
      </p>

      <button
        className={inList ? "btn-watchlist in" : "btn-watchlist"}
        onClick={() => toggleWatchlist(movie.id)}
      >
        {inList ? "In Watchlist" : "Add to Watchlist"}
      </button>
    </div>
  );
}




















export default function NavBar({ activeTab, onChangeTab, watchlistCount }) {
  return (
    <div className="nav">
      <button
        className={`nav-btn ${activeTab === "home" ? "active" : ""}`}
        onClick={() => onChangeTab("home")}
      >
        Home
      </button>

      <button
        className={`nav-btn ${activeTab === "watchlist" ? "active" : ""}`}
        onClick={() => onChangeTab("watchlist")}
      >
        Watchlist{watchlistCount ? ` (${watchlistCount})` : ""}
      </button>
    </div>
  );
}





















export default function FiltersBar({
  search,
  setSearch,
  selectedGenre,
  setSelectedGenre,
  sortType,
  setSortType,
  genres,
}) {
  return (
    <>
      <input
        className="search"
        placeholder="Search movies..."
        value={search}
        onChange={(e) => setSearch(e.target.value)}
      />

      <div className="filters">
        <div className="filter">
          <span>Genre</span>
          <select value={selectedGenre} onChange={(e) => setSelectedGenre(e.target.value)}>
            <option value="all">All Genres</option>
            {genres.map((genre) => (
              <option key={genre} value={genre}>
                {genre}
              </option>
            ))}
          </select>
        </div>

        <div className="filter">
          <span>Sort</span>
          <select value={sortType} onChange={(e) => setSortType(e.target.value)}>
            <option value="none">None</option>
            <option value="rating-desc">Rating (High to Low)</option>
            <option value="rating-asc">Rating (Low to High)</option>
            <option value="alphabet">A-Z</option>
          </select>
        </div>
      </div>
    </>
  );
}





















import { useMemo, useState } from "react";
import MovieCard from "../components/MovieCard";
import FiltersBar from "../components/FiltersBar";

export default function Home({ movies }) {
  const [sortType, setSortType] = useState("none");
  const [search, setSearch] = useState("");
  const [selectedGenre, setSelectedGenre] = useState("all");

  const genres = useMemo(() => [...new Set(movies.map((m) => m.genre))], [movies]);

  const visibleMovies = useMemo(() => {
    const filtered = movies.filter((movie) => {
      const matchesSearch = movie.title.toLowerCase().includes(search.toLowerCase());
      const matchesGenre = selectedGenre === "all" || movie.genre === selectedGenre;
      return matchesSearch && matchesGenre;
    });

    const sorted = [...filtered];
    if (sortType === "rating-desc") sorted.sort((a, b) => Number(b.rating) - Number(a.rating));
    else if (sortType === "rating-asc") sorted.sort((a, b) => Number(a.rating) - Number(b.rating));
    else if (sortType === "alphabet") sorted.sort((a, b) => a.title.localeCompare(b.title));

    return sorted;
  }, [movies, search, selectedGenre, sortType]);

  return (
    <>
      <FiltersBar
        search={search}
        setSearch={setSearch}
        selectedGenre={selectedGenre}
        setSelectedGenre={setSelectedGenre}
        sortType={sortType}
        setSortType={setSortType}
        genres={genres}
      />

      <div className="grid">
        {visibleMovies.map((m) => (
          <MovieCard key={m.id} movie={m} />
        ))}
      </div>
    </>
  );
}






















import MovieCard from "../components/MovieCard";
import { useWatchlist } from "../context/WatchlistContext";

export default function Watchlist({ movies }) {
  const { watchlistIds } = useWatchlist();
  const watchlistMovies = movies.filter((m) => watchlistIds.includes(m.id));

  if (watchlistMovies.length === 0) {
    return <p style={{ opacity: 0.8 }}>Your watchlist is empty.</p>;
  }

  return (
    <div className="grid">
      {watchlistMovies.map((m) => (
        <MovieCard key={m.id} movie={m} />
      ))}
    </div>
  );
}






















import { useState } from "react";
import movies from "./data/movies.json";

import { WatchlistProvider, useWatchlist } from "./context/WatchlistContext";
import NavBar from "./components/NavBar";
import Home from "./pages/Home";
import Watchlist from "./pages/Watchlist";

function AppShell() {
  const [tab, setTab] = useState("home");
  const { watchlistIds } = useWatchlist();

  return (
    <div className="container">
      <NavBar activeTab={tab} onChangeTab={setTab} watchlistCount={watchlistIds.length} />
      {tab === "home" ? <Home movies={movies} /> : <Watchlist movies={movies} />}
    </div>
  );
}

export default function App() {
  return (
    <WatchlistProvider>
      <AppShell />
    </WatchlistProvider>
  );
}
