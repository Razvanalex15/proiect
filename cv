<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vremea (Open-Meteo)</title>

  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <h1>Vremea pe oraÈ™ (Geocoding â†’ Forecast)</h1>
      <button id="themeBtn" type="button" aria-label="SchimbÄƒ tema">ðŸŒ“</button>
    </div>

    <div class="card">
      <div class="row">
        <input id="q" placeholder="Scrie un oraÈ™ (ex: BucureÈ™ti)" value="BucureÈ™ti" />
        <button id="searchBtn" type="button">CautÄƒ</button>
        <span class="muted">Tip: scrie minim 3 litere pentru rezultate mai bune.</span>
      </div>

      <p id="status" class="muted"></p>
      <p id="err" class="error"></p>

      <div id="pickWrap" style="display:none; margin-top: 10px;">
        <div class="row">
          <label for="pick" class="muted">Alege locaÈ›ia:</label>
          <select id="pick"></select>
          <button id="loadBtn" type="button">AfiÈ™eazÄƒ vremea</button>
        </div>
      </div>
    </div>

    <div id="out" class="card" style="display:none;">
      <div class="row" style="justify-content: space-between;">
        <div>
          <h2 id="place"></h2>
          <div id="meta" class="muted"></div>
        </div>
        <div class="pill" id="now"></div>
      </div>

      <div id="map" class="map"></div>

      <div class="grid2">
        <div>
          <h3>UrmÄƒtoarele 12 ore</h3>
          <table>
            <thead>
              <tr>
                <th>Ora</th>
                <th>Temp</th>
                <th>VÃ¢nt</th>
                <th>Cod</th>
              </tr>
            </thead>
            <tbody id="hourRows"></tbody>
          </table>
        </div>

        <div>
          <h3>UrmÄƒtoarele 7 zile</h3>
          <table>
            <thead>
              <tr>
                <th>Zi</th>
                <th>Min / Max</th>
                <th>Cod</th>
              </tr>
            </thead>
            <tbody id="dayRows"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="script.js"></script>
</body>
</html>



























* { box-sizing: border-box; }

/* Variabile - Tema Light" */
:root{
  --bg: #f7f8fa;
  --text: #111;
  --card: #fff;
  --border: #ddd;
  --border-soft: #e6e6e6;
  --border-input: #ccc;
  --danger: #b00020;
}

/* Variabile - Tema Dark" */
:root[data-theme="dark"]{
  --bg: #0b1020;
  --text: #e5e7eb;
  --card: #121a33;
  --border: #2a355c;
  --border-soft: #2a355c;
  --border-input: #3a4a7a;
  --danger: #ff4d6d;
}

body{
  font-family: system-ui, Arial, sans-serif;
  margin: 0;
  padding: 24px;
  background: var(--bg);
  color: var(--text);
}

.wrap{
  max-width: 980px;
  margin: 0 auto;
  display: grid;
  gap: 14px;
}

/* Bara de sus - Titlu stanga, buton dreapta */
.topbar{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.topbar h1{ margin: 0; }

.card{
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 16px;
  background: var(--card);
}

.row{
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
}

/* Design system pentru control-uri */
input, select, button{
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid var(--border-input);
  font: inherit;
  background: var(--card);
  color: var(--text);
}

button{ cursor: pointer; }

#themeBtn{
  padding: 6px 10px;
  border-radius: 999px;
  width: auto;
}

.muted{ opacity: 0.75; }

.error{ color: var(--danger); }

.grid2{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 14px;
}

@media (max-width: 820px){
  .grid2{ grid-template-columns: 1fr; }
}

table{
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

table th, table td{
  text-align: left;
  padding: 10px;
  border-top: 1px solid var(--border-soft);
}

table th{ font-weight: 650; }

.pill{
  display: inline-block;
  padding: 4px 10px;
  border: 1px solid var(--border-soft);
  border-radius: 999px;
}

.map{
  margin-top: 14px;
  height: 320px;
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid var(--border);
  background: var(--card);
}

























/* Tema (light/dark) - o salvez in localStorage ca sa ramana si dupa refresh */
const root = document.documentElement;
const btn = document.getElementById("themeBtn");

export function setTheme(theme) {
  root.dataset.theme = theme;
  localStorage.setItem("theme", theme);
  if (btn) btn.textContent = theme === "dark" ? "â˜€ï¸" : "ðŸŒ™";
}

export function initTheme() {
  setTheme(
    localStorage.getItem("theme") ||
    (matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light")
  );

  if (btn) {
    btn.addEventListener("click", () =>
      setTheme(root.dataset.theme === "dark" ? "light" : "dark")
    );
  }
}









/* Geocoding: gasesc coordonatele orasului */
export async function geocode(name) {
  const url = new URL("https://geocoding-api.open-meteo.com/v1/search");
  url.searchParams.set("name", name);
  url.searchParams.set("count", "5");
  url.searchParams.set("language", "ro");
  url.searchParams.set("format", "json");

  const res = await fetch(url);
  if (!res.ok) throw new Error("Geocoding failed");
  const data = await res.json();
  return data.results || [];
}

/* Forecast: iau prognoza pe coordonate */
export async function forecast(lat, lon) {
  const url = new URL("https://api.open-meteo.com/v1/forecast");
  url.searchParams.set("latitude", lat);
  url.searchParams.set("longitude", lon);
  url.searchParams.set("current", "temperature_2m,wind_speed_10m,weather_code");
  url.searchParams.set("hourly", "temperature_2m,wind_speed_10m,weather_code");
  url.searchParams.set("daily", "temperature_2m_min,temperature_2m_max,weather_code");
  url.searchParams.set("forecast_days", "7");
  url.searchParams.set("timezone", "auto");

  const res = await fetch(url);
  if (!res.ok) throw new Error("Forecast failed");
  return res.json();
}

/* Traduc codurile meteo(WMO) in text */
export function weatherCodeText(code) {
  const c = Number(code);
  if (c === 0) return "Senin";
  if ([1, 2, 3].includes(c)) return "ParÈ›ial noros";
  if ([45, 48].includes(c)) return "CeaÈ›Äƒ";
  if ([51, 53, 55].includes(c)) return "BurniÈ›Äƒ";
  if ([61, 63, 65].includes(c)) return "Ploaie";
  if ([71, 73, 75].includes(c)) return "Ninsoare";
  if ([80, 81, 82].includes(c)) return "Averse";
  if ([95, 96, 99].includes(c)) return "FurtunÄƒ";
  return "Cod: " + c;
}







// map.js
let map;
let marker;

/* Pornesc harta din Bucuresti(default) si pun un marker initial */
export function initMap() {
  if (map) return map;

  map = L.map("map").setView([44.4323, 26.1063], 11);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "&copy; OpenStreetMap contributors",
  }).addTo(map);

  marker = L.marker([44.4323, 26.1063]).addTo(map);
  return map;
}

export function updateMap({ lat, lon, popupHtml }) {
  initMap();
  map.setView([lat, lon], 11);
  marker.setLatLng([lat, lon]);

  if (popupHtml) marker.bindPopup(popupHtml).openPopup();

  /* Leaflet are nevoie de refresh */
  setTimeout(() => map.invalidateSize(), 0);
}





















import { initTheme } from "./theme.js";
import { geocode, forecast, weatherCodeText } from "./api.js";
import { updateMap } from "./map.js";

const $ = (s) => document.querySelector(s);

let lastResults = [];

/* Umplu dropdown-ul cu rezultatele gasite */
function fillPick(results) {
  const pick = $("#pick");
  pick.innerHTML = "";

  results.forEach((r, i) => {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = `${r.name} (${r.country})`;
    pick.appendChild(opt);
  });

  $("#pickWrap").style.display = results.length ? "block" : "none";
}

/* Afisez tot UI-ul dupa ce am datele */
function render(place, data) {
  $("#out").style.display = "block";

  $("#place").textContent = `${place.name}, ${place.country}`;
  $("#meta").textContent = `Coordonate: ${place.latitude.toFixed(2)}, ${place.longitude.toFixed(2)}`;

  const cur = data.current;
  $("#now").textContent =
    `${cur.temperature_2m}${data.current_units.temperature_2m} â€¢ ` +
    `${weatherCodeText(cur.weather_code)}`;

  /* update harta */ 
  updateMap({
    lat: place.latitude,
    lon: place.longitude,
    popupHtml:
      `<b>${place.name}, ${place.country}</b><br>` +
      `${cur.temperature_2m}${data.current_units.temperature_2m} â€¢ ${weatherCodeText(cur.weather_code)}`,
  });

  /* tabel ore */
  $("#hourRows").innerHTML = "";
  for (let i = 0; i < 12; i++) {
    $("#hourRows").innerHTML += `
      <tr>
        <td>${data.hourly.time[i].replace("T", " ")}</td>
        <td>${data.hourly.temperature_2m[i]}</td>
        <td>${data.hourly.wind_speed_10m[i]}</td>
        <td>${data.hourly.weather_code[i]}</td>
      </tr>`;
  }

  /* tabel zile */
  $("#dayRows").innerHTML = "";
  for (let i = 0; i < data.daily.time.length; i++) {
    $("#dayRows").innerHTML += `
      <tr>
        <td>${data.daily.time[i]}</td>
        <td>${data.daily.temperature_2m_min[i]} / ${data.daily.temperature_2m_max[i]}</td>
        <td>${data.daily.weather_code[i]}</td>
      </tr>`;
  }
}

/* Caut orasul din input */
async function onSearch() {
  $("#status").textContent = "Caut oraÈ™eâ€¦";
  $("#err").textContent = "";
  $("#out").style.display = "none";

  try {
    const query = $("#q").value.trim();
    lastResults = await geocode(query);

    if (!lastResults.length) {
      $("#status").textContent = "";
      $("#err").textContent = "Nu am gÄƒsit rezultate.";
      $("#pickWrap").style.display = "none";
      return;
    }

    fillPick(lastResults);
    $("#status").textContent = "Alege locaÈ›ia.";
  } catch (e) {
    $("#err").textContent = e.message;
  }
}

/* Incarc prognoza pentru orasul selectat */
async function onLoadForecast() {
  const place = lastResults[Number($("#pick").value)];
  const data = await forecast(place.latitude, place.longitude);
  render(place, data);
}

// init
initTheme();

$("#searchBtn").addEventListener("click", onSearch);
$("#loadBtn").addEventListener("click", onLoadForecast);
$("#q").addEventListener("keydown", (e) => {
  if (e.key === "Enter") onSearch();
});

/* Auto-run la inceput (Bucuresti e pus by default in input) */
onSearch();
